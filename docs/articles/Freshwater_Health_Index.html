<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Freshwater Health Index • FHI</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Freshwater Health Index">
<meta property="og:description" content="FHI">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FHI</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Freshwater_Health_Index.html">Freshwater Health Index</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/Nick-Souter/FHI/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Freshwater Health Index</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/Nick-Souter/FHI/blob/HEAD/vignettes/Freshwater_Health_Index.Rmd" class="external-link"><code>vignettes/Freshwater_Health_Index.Rmd</code></a></small>
      <div class="hidden name"><code>Freshwater_Health_Index.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="ecosystem-vitality">Ecosystem Vitality<a class="anchor" aria-label="anchor" href="#ecosystem-vitality"></a>
</h2>
<div class="section level3">
<h3 id="deviation-from-the-natural-flow-regime">Deviation from the Natural Flow Regime<a class="anchor" aria-label="anchor" href="#deviation-from-the-natural-flow-regime"></a>
</h3>
<p>The FHI R package is able to calculate the Deviation from the Natural
Flow Regime (DvNF) sub indicator for both modelled and recorded flow or
height data.</p>
<div class="section level4">
<h4 id="dvnf-for-modelled-data">DvNF for Modelled data<a class="anchor" aria-label="anchor" href="#dvnf-for-modelled-data"></a>
</h4>
<p>Modelled data consists of a paired set of daily flow or height data,
one for natural conditions the other for modified (current or a future
development scenario). The DvNF metric is calculated using comparisons
of monthly flow and this function takes the daily flow, averages it for
every month and calculates DvNF. If you already have monthly flow data
DvNF can be calculated using the FHI tool box. An input file with three
columns is required comprising the Date in the format YYYY/MM/DD,
Regulated and Unregulated flow (e.g.Table 1).</p>
<table class="table">
<caption>Table 1. Example paried daily lake height data for natural and
current conditions.</caption>
<thead><tr class="header">
<th align="left">Date</th>
<th align="right">Regulated</th>
<th align="right">Unregulated</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1985/01/01</td>
<td align="right">2.541</td>
<td align="right">2.541</td>
</tr>
<tr class="even">
<td align="left">1985/01/02</td>
<td align="right">2.605</td>
<td align="right">2.605</td>
</tr>
<tr class="odd">
<td align="left">1985/01/03</td>
<td align="right">2.658</td>
<td align="right">2.657</td>
</tr>
<tr class="even">
<td align="left">1985/01/04</td>
<td align="right">2.692</td>
<td align="right">2.683</td>
</tr>
<tr class="odd">
<td align="left">1985/01/05</td>
<td align="right">2.703</td>
<td align="right">2.673</td>
</tr>
<tr class="even">
<td align="left">1985/01/06</td>
<td align="right">2.694</td>
<td align="right">2.656</td>
</tr>
<tr class="odd">
<td align="left">1985/01/07</td>
<td align="right">2.680</td>
<td align="right">2.634</td>
</tr>
<tr class="even">
<td align="left">1985/01/08</td>
<td align="right">2.664</td>
<td align="right">2.611</td>
</tr>
<tr class="odd">
<td align="left">1985/01/09</td>
<td align="right">2.647</td>
<td align="right">2.586</td>
</tr>
<tr class="even">
<td align="left">1985/01/10</td>
<td align="right">2.628</td>
<td align="right">2.561</td>
</tr>
</tbody>
</table>
<p>To run the function you need to load the ‘dplyr’ package and have
‘lubridate’ installed - if all goes well the code will call it as
needed.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></code></pre></div>
<p>To calculate DvNF use the <code>DvNF_model</code> function as
follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/DvNF_model.html">DvNF_model</a></span><span class="op">(</span><span class="va">KL_MOD</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'Month'. You can override using the</span>
<span class="co">#&gt; `.groups` argument.</span>
<span class="co">#&gt; `summarise()` has grouped output by 'Month'. You can override using the</span>
<span class="co">#&gt; `.groups` argument.</span>
<span class="co">#&gt;       AAPFD     DvNF</span>
<span class="co">#&gt; 1 0.2390401 76.09599</span></code></pre></div>
<p>This provides two outputs AAPFD, the Amended Annual Proportional Flow
Deviation from which Deviation from Natural Flow Regime (DvNF) is
calculated.</p>
</div>
<div class="section level4">
<h4 id="dvnf-for-measured-data">DvNF for Measured data<a class="anchor" aria-label="anchor" href="#dvnf-for-measured-data"></a>
</h4>
<p>Measured data consists of a time series of measured daily flow or
height data. The DvNF metric is calculated using comparisons of monthly
flow and this function takes the daily flow, averages it for every month
and calculates DvNF. The FHI tool box currently cannot calculate DvNF
from a time series of measured data. An input file with two columns is
required comprising the Date in the format YYYY/MM/DD, and measured flow
or height data (e.g.Table 2).</p>
<table class="table">
<caption>Table 2. Example measured daily lake height data.</caption>
<thead><tr class="header">
<th align="left">Date</th>
<th align="right">Height</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1960/01/01</td>
<td align="right">3.41</td>
</tr>
<tr class="even">
<td align="left">1960/01/02</td>
<td align="right">3.24</td>
</tr>
<tr class="odd">
<td align="left">1960/01/03</td>
<td align="right">3.11</td>
</tr>
<tr class="even">
<td align="left">1960/01/04</td>
<td align="right">3.07</td>
</tr>
<tr class="odd">
<td align="left">1960/01/05</td>
<td align="right">3.07</td>
</tr>
<tr class="even">
<td align="left">1960/01/06</td>
<td align="right">2.96</td>
</tr>
<tr class="odd">
<td align="left">1960/01/07</td>
<td align="right">2.85</td>
</tr>
<tr class="even">
<td align="left">1960/01/08</td>
<td align="right">2.80</td>
</tr>
<tr class="odd">
<td align="left">1960/01/09</td>
<td align="right">2.66</td>
</tr>
<tr class="even">
<td align="left">1960/01/10</td>
<td align="right">2.57</td>
</tr>
</tbody>
</table>
<p>To run the function you need to load two packages ‘lubridate’ and
‘dplyr’ To calculate DvNF use the <code>DvNF_gauge</code> function
entering the name of the input data file, the start year for regulated
period (in this case, 2014) and end year of the unregulated data (in
this case 1990).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/DvNF_gauge.html">DvNF_gauge</a></span><span class="op">(</span><span class="va">PK_HT</span>, <span class="fl">2014</span>, <span class="fl">1990</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'Month'. You can override using the</span>
<span class="co">#&gt; `.groups` argument.</span>
<span class="co">#&gt;       AAPFD     DvNF</span>
<span class="co">#&gt; 1 0.6080495 67.83901</span></code></pre></div>
<p>This provides two outputs AAPFD, the Amended Annual Proportional Flow
Deviation from which Deviation from Natural Flow Regime (DvNF) is
calculated.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="water-quality">Water Quality<a class="anchor" aria-label="anchor" href="#water-quality"></a>
</h2>
<p>The FHI has two water quality metrics. The Ecosystem Vitality Water
Quality metric measures the deviation of several water quality metrics
from benchmarks for the protection of aquatic ecosystems. The metric has
three major indicators which can be calculated using the following
functions: total nitrogen, <code>EV_TN</code>; and total phosphorous,
<code>EV_TP</code>; and suspended solids in surface
water,<code>EV_TSS</code>. This last function is only used for cases
where threshold values for suspended solids are undefined as per Souter
et al., (2020). Along with these parameters several other indicators of
major concern for water quality can also be added and along with pH,
<code>EV_pH</code>; may include temperature, salinity, dissolved oxygen,
electrical conductivity, total dissolved solids, heavy metals and
coliforms, pharmaceuticals and other contaminants. These and other
parameters can be calculaed using two generic functions
<code>EV_WQ</code> when threshold values are known, or
<code>EV_WQU</code> when thresholds are unknown but can be calculated
using the method described for total suspended soilds in Souter et al.,
(2020). The Ecosystem Service Regulation and Support indicators includes
the Deviation of Water Quality Metrics from Benchmarks indicator. For
some indicators this uses different thresholds than the Ecosystem
Vitality indicator and is not limited in the number of parameters
measured. However the same functions are used.</p>
<p>To run these functions you need four packages. Two, ‘plyr’,‘dplyr’,
need to be loaded.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/plyr" class="external-link">plyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></code></pre></div>
<p>Whilst ‘gdata’ and ‘reshape2’ need only be installed as the code will
call them when required.</p>
<table class="table">
<caption>Table 3. Example water quality data.</caption>
<colgroup>
<col width="15%">
<col width="6%">
<col width="9%">
<col width="7%">
<col width="8%">
<col width="6%">
<col width="12%">
<col width="10%">
<col width="12%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="left">Name</th>
<th align="right">Year</th>
<th align="right">Month_1</th>
<th align="left">Month</th>
<th align="right">TEMP_C</th>
<th align="right">pH</th>
<th align="right">TSS_mgL</th>
<th align="right">COND_mSm</th>
<th align="right">Ca_meqL</th>
<th align="right">Mg_meqL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Andaung Meas</td>
<td align="right">2011</td>
<td align="right">4</td>
<td align="left">Apr</td>
<td align="right">27.5</td>
<td align="right">5.31</td>
<td align="right">10.00000</td>
<td align="right">5.96</td>
<td align="right">0.1594750</td>
<td align="right">0.1122231</td>
</tr>
<tr class="even">
<td align="left">Andaung Meas</td>
<td align="right">2008</td>
<td align="right">8</td>
<td align="left">Aug</td>
<td align="right">28.0</td>
<td align="right">5.57</td>
<td align="right">84.50000</td>
<td align="right">3.31</td>
<td align="right">0.1625103</td>
<td align="right">0.0237820</td>
</tr>
<tr class="odd">
<td align="left">Lumphat</td>
<td align="right">2007</td>
<td align="right">9</td>
<td align="left">Sep</td>
<td align="right">27.0</td>
<td align="right">5.63</td>
<td align="right">89.00089</td>
<td align="right">3.91</td>
<td align="right">0.1289673</td>
<td align="right">0.1209068</td>
</tr>
<tr class="even">
<td align="left">Lumphat</td>
<td align="right">2012</td>
<td align="right">10</td>
<td align="left">Oct</td>
<td align="right">30.0</td>
<td align="right">5.64</td>
<td align="right">79.00000</td>
<td align="right">6.85</td>
<td align="right">0.2487562</td>
<td align="right">0.1611940</td>
</tr>
<tr class="odd">
<td align="left">Siempang</td>
<td align="right">2011</td>
<td align="right">4</td>
<td align="left">Apr</td>
<td align="right">31.5</td>
<td align="right">5.65</td>
<td align="right">9.00000</td>
<td align="right">7.98</td>
<td align="right">0.4095160</td>
<td align="right">0.1338802</td>
</tr>
<tr class="even">
<td align="left">Andaung Meas</td>
<td align="right">2007</td>
<td align="right">9</td>
<td align="left">Sep</td>
<td align="right">26.5</td>
<td align="right">5.90</td>
<td align="right">176.00158</td>
<td align="right">3.03</td>
<td align="right">0.0846348</td>
<td align="right">0.0725441</td>
</tr>
<tr class="odd">
<td align="left">Andaung Meas</td>
<td align="right">2012</td>
<td align="right">8</td>
<td align="left">Aug</td>
<td align="right">28.0</td>
<td align="right">6.00</td>
<td align="right">165.00000</td>
<td align="right">3.76</td>
<td align="right">0.1270358</td>
<td align="right">0.0371336</td>
</tr>
<tr class="even">
<td align="left">Andaung Meas</td>
<td align="right">2012</td>
<td align="right">3</td>
<td align="left">Mar</td>
<td align="right">29.0</td>
<td align="right">6.00</td>
<td align="right">5.00000</td>
<td align="right">4.79</td>
<td align="right">0.1606695</td>
<td align="right">0.1345607</td>
</tr>
<tr class="odd">
<td align="left">Lumphat</td>
<td align="right">2005</td>
<td align="right">9</td>
<td align="left">Sep</td>
<td align="right">27.0</td>
<td align="right">6.03</td>
<td align="right">35.00000</td>
<td align="right">4.20</td>
<td align="right">0.1691000</td>
<td align="right">0.1031000</td>
</tr>
<tr class="even">
<td align="left">Andaung Meas</td>
<td align="right">2006</td>
<td align="right">9</td>
<td align="left">Sep</td>
<td align="right">26.5</td>
<td align="right">6.08</td>
<td align="right">58.00000</td>
<td align="right">2.47</td>
<td align="right">0.0890000</td>
<td align="right">0.0300000</td>
</tr>
</tbody>
</table>
<p>As examples calculate three of the metrics: total nitrogen,
<code>EV_TN</code>; and total phosphorous, <code>EV_TP</code>; and
suspended solids in surface water,<code>EV_TSS</code></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/EV_TN.html">EV_TN</a></span><span class="op">(</span><span class="va">Wq3S_Cam</span>, <span class="fl">0</span>, <span class="fl">1.6</span><span class="op">)</span>
<span class="co">#&gt;   Parameter F1       F2        F3 ESI_F1_3</span>
<span class="co">#&gt; 1        TN 50 2.953586 0.5170908 94.91526</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/EV_TP.html">EV_TP</a></span><span class="op">(</span><span class="va">Wq3S_Cam</span>, <span class="fl">0.13</span><span class="op">)</span>
<span class="co">#&gt;   Parameter  F1       F2       F3 ESI_F1_3</span>
<span class="co">#&gt; 1        TP 100 18.48101 11.20306 66.52903</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/EV_TSS.html">EV_TSS</a></span><span class="op">(</span><span class="va">Wq3S_Cam</span>, <span class="fl">2008</span><span class="op">)</span>
<span class="co">#&gt;   Parameter  F1       F2      F3 ESI_F1_3</span>
<span class="co">#&gt; 1       TSS 100 17.15686 14.0242  62.5511</span></code></pre></div>
<p>These outputs provide values for F1, F2, F3 and the final ESI
indicator calculated by combinign the F1 and F3 values as per Shaad et
al 2021 (PUT IN URL WHEN PAPER IS PUBLISHED). Each water quality output
needs to be saved as an object:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TN_WQ</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/EV_TN.html">EV_TN</a></span><span class="op">(</span><span class="va">Wq3S_Cam</span>, <span class="fl">0</span>, <span class="fl">1.6</span><span class="op">)</span>
<span class="va">TP_WQ</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/EV_TP.html">EV_TP</a></span><span class="op">(</span><span class="va">Wq3S_Cam</span>, <span class="fl">0.13</span><span class="op">)</span>
<span class="va">TSS_WQ</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/EV_TSS.html">EV_TSS</a></span><span class="op">(</span><span class="va">Wq3S_Cam</span>, <span class="fl">2008</span><span class="op">)</span></code></pre></div>
<p>You then need to combine these objects to then calculate either the
arithmetic or geometric mean to give the final score. First however you
need to subset and combine the ESI values into a single dataframe.</p>
<p>First reduce the dataframe to just the ESI value and rename it, this
is a two step process for each water quality parameter, first TN</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TN_ESI</span><span class="op">&lt;-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">TN_WQ</span>, <span class="va">ESI_F1_3</span><span class="op">)</span>
<span class="va">TN_ESI</span><span class="op">&lt;-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">TN_ESI</span>, TN<span class="op">=</span><span class="va">ESI_F1_3</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TN_ESI</span>
<span class="co">#&gt;         TN</span>
<span class="co">#&gt; 1 94.91526</span></code></pre></div>
<p>Repeat for TP and TSS:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">TP_ESI</span><span class="op">&lt;-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">TP_WQ</span>, <span class="va">ESI_F1_3</span><span class="op">)</span>
<span class="va">TP_ESI</span><span class="op">&lt;-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">TP_ESI</span>, TP<span class="op">=</span><span class="va">ESI_F1_3</span><span class="op">)</span>
<span class="va">TSS_ESI</span><span class="op">&lt;-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">TSS_WQ</span>, <span class="va">ESI_F1_3</span><span class="op">)</span>
<span class="va">TSS_ESI</span><span class="op">&lt;-</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="va">TSS_ESI</span>, TSS<span class="op">=</span><span class="va">ESI_F1_3</span><span class="op">)</span></code></pre></div>
<p>As the merge function will only combine two objects at a time, you
will need to sequentially merge the individual water quality objects.
Start with two ojects in this case <code>TP_ESI</code> and
<code>TN_ESI</code> which you merge to create <code>WQ_ESI</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">WQ_ESI</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">TP_ESI</span>, <span class="va">TN_ESI</span><span class="op">)</span></code></pre></div>
<p>Then use add other objects to <code>WQ_ESI</code> until all are
combined into a dataframe</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">WQ_ESI</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">WQ_ESI</span>, <span class="va">TSS_ESI</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">WQ_ESI</span>
<span class="co">#&gt;         TP       TN     TSS</span>
<span class="co">#&gt; 1 66.52903 94.91526 62.5511</span></code></pre></div>
<p>Using this dataframe you can then calculate either the arithmetic
mean</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">WQ_ESI</span><span class="op">)</span>
<span class="co">#&gt; [1] 74.66513</span></code></pre></div>
<p>or the geometric mean</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">WQ_ESI</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 73.3715</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="ecosystem-service-indicator">Ecosystem Service Indicator<a class="anchor" aria-label="anchor" href="#ecosystem-service-indicator"></a>
</h2>
<p>The FHI measures a suite of Provisioning, Regulation &amp; Support,
and Cultural Ecosystem Service indicators. The Provisioning and
Regulation &amp; Support indicators are calculated using the method
outlined in Shaad et al. (2021). Shaad et al., (2021) describe three
alternative methods that can be used to calculate the indicator. The FHI
package contains functions that can calculate Method 1 and the
recommended Method 2. To calculate both methods the a data file with two
column headings: Name, which provides the spatial data, and Variable,
which is the measurement of the ecosystem service.</p>
<table class="table">
<caption>Table 4. Example ecosystem service data.</caption>
<thead><tr class="header">
<th align="left">Name</th>
<th align="right">Variable</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Site_1</td>
<td align="right">0.0437</td>
</tr>
<tr class="even">
<td align="left">Site_1</td>
<td align="right">0.3590</td>
</tr>
<tr class="odd">
<td align="left">Site_1</td>
<td align="right">0.0258</td>
</tr>
<tr class="even">
<td align="left">Site_1</td>
<td align="right">0.0481</td>
</tr>
<tr class="odd">
<td align="left">Site_1</td>
<td align="right">0.0071</td>
</tr>
<tr class="even">
<td align="left">Site_1</td>
<td align="right">0.0153</td>
</tr>
<tr class="odd">
<td align="left">Site_1</td>
<td align="right">0.0248</td>
</tr>
<tr class="even">
<td align="left">Site_1</td>
<td align="right">0.0240</td>
</tr>
<tr class="odd">
<td align="left">Site_1</td>
<td align="right">0.0706</td>
</tr>
<tr class="even">
<td align="left">Site_1</td>
<td align="right">0.0823</td>
</tr>
</tbody>
</table>
<p>As with the water quality variables the user needs to provide a
threshold value for the ecosystem service. The function requires four
packages. Two, ‘plyr’,‘dplyr’, need to be loaded.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/plyr" class="external-link">plyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></code></pre></div>
<p>Whilst ‘gdata’ and ‘reshape2’ need only be installed as the code will
call them when required.</p>
<div class="section level3">
<h3 id="method-1">Method 1<a class="anchor" aria-label="anchor" href="#method-1"></a>
</h3>
<p>To calculate the indicator using Method 1 you use the
<code>ES_M1</code> function, which has two parameters:</p>
<ul>
<li>x - the input date file, ES_test in our example</li>
<li>Threshold - Threshold value, 0.13 in our example. If the variable
falls below this value then the service is not being met.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ES_M1.html">ES_M1</a></span><span class="op">(</span><span class="va">ES_test</span>, <span class="fl">0.13</span><span class="op">)</span>
<span class="co">#&gt;   Parameter  F1       F2       F3   ESI_F3</span>
<span class="co">#&gt; 1        ES 100 81.51899 81.62973 11.85475</span></code></pre></div>
<p>The <code>ES_M1</code> function provides measures of F1, F2, F3 and a
single ESI score which combines the three F scores as per Shaad et al
(2021).</p>
</div>
<div class="section level3">
<h3 id="method-2">Method 2<a class="anchor" aria-label="anchor" href="#method-2"></a>
</h3>
<p>Similarly to calculate the indicator using Method 2 you use the
<code>ES_M2</code> function, which has the same two parameters:</p>
<ul>
<li>x - the input date file, ES_test in our example</li>
<li>Threshold - Threshold value, 0.13 in our example. If the variable
falls below this value then the service is not being met.</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ES_M2.html">ES_M2</a></span><span class="op">(</span><span class="va">ES_test</span>, <span class="fl">0.13</span><span class="op">)</span>
<span class="co">#&gt;   Parameter  F1       F2       F3 ESI_F1 ESI_F1_2 ESI_F1_3</span>
<span class="co">#&gt; 1        ES 100 81.51899 81.62973      0 9.712134  9.65083</span></code></pre></div>
<p>The <code>ES_M2</code> function provides measures of F1, F2, F3 and
three ESI scores as per Shaad et al (2021). ESI_F1 uses the F1 value
only, ESI_F1_2 combines F1 and F2 and ESI_F1_3 combines the F1 and F3
scores.</p>
</div>
</div>
<div class="section level2">
<h2 id="tonle-sap-lake-daily-fish-catch">Tonle Sap Lake daily fish catch<a class="anchor" aria-label="anchor" href="#tonle-sap-lake-daily-fish-catch"></a>
</h2>
<div class="section level3">
<h3 id="biomass-for-consumption">Biomass for consumption<a class="anchor" aria-label="anchor" href="#biomass-for-consumption"></a>
</h3>
<p>Local fishers on Cambodia’s Tonle Sap lake collect a variety of daily
catch data. The total weight of their catch can be used to calculate the
Ecosystem Service biomass for consumption metric. To calculate the
metric a daily catch threshold value and spatial groups are required.
The following input data is used:</p>
<table style="width:100%;" class="table">
<caption>Table 5. Example daily fish catch data.</caption>
<colgroup>
<col width="10%">
<col width="11%">
<col width="9%">
<col width="11%">
<col width="7%">
<col width="8%">
<col width="29%">
<col width="12%">
</colgroup>
<thead><tr class="header">
<th align="right">CatchRecord</th>
<th align="right">WeightCaught</th>
<th align="left">CatchDate</th>
<th align="left">Station</th>
<th align="right">Latitude</th>
<th align="right">Longitude</th>
<th align="left">Habitat</th>
<th align="left">Location</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">16.0</td>
<td align="left">2015/01/17</td>
<td align="left">Ou Ta Prok</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">Open water</td>
<td align="left">Srong Kaeak</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">5.0</td>
<td align="left">2015/01/18</td>
<td align="left">Ou Ta Prok</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">Open water near forest edge</td>
<td align="left">Plov Krobey</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">80.0</td>
<td align="left">2015/01/25</td>
<td align="left">Ou Ta Prok</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">Open water near conservation site</td>
<td align="left">Dorng Koum</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">22.0</td>
<td align="left">2015/01/26</td>
<td align="left">Ou Ta Prok</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">Open water near conservation site</td>
<td align="left">Dorng Koum</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">8.2</td>
<td align="left">2015/01/26</td>
<td align="left">Ou Ta Prok</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">Open water near conservation site</td>
<td align="left">Dorng Koum</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">15.1</td>
<td align="left">2015/01/27</td>
<td align="left">Ou Ta Prok</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">Open water</td>
<td align="left">Chambang Youn</td>
</tr>
<tr class="odd">
<td align="right">7</td>
<td align="right">5.0</td>
<td align="left">2015/01/27</td>
<td align="left">Ou Ta Prok</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">Open water</td>
<td align="left">Chambang Youn</td>
</tr>
<tr class="even">
<td align="right">8</td>
<td align="right">3.0</td>
<td align="left">2015/01/11</td>
<td align="left">Anlong Reang</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">Open water near conservation site</td>
<td align="left">Dorng Koum</td>
</tr>
<tr class="odd">
<td align="right">9</td>
<td align="right">4.0</td>
<td align="left">2015/01/12</td>
<td align="left">Anlong Reang</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">Open water near conservation site</td>
<td align="left">Dorng Koum</td>
</tr>
<tr class="even">
<td align="right">10</td>
<td align="right">3.0</td>
<td align="left">2015/01/13</td>
<td align="left">Anlong Reang</td>
<td align="right">NA</td>
<td align="right">NA</td>
<td align="left">Open water near conservation site</td>
<td align="left">Dorng Koum</td>
</tr>
</tbody>
</table>
<p>As with the other functions the Date (as recorded in the CatchDate
column) needs to be formatted as YYYY/MM/DD. The WeightCaught column
lists the total weight of the fishers combined catch in kg. Station is
the highest level of spatial grouping. And Location is a spatial
grouping nested within each Location. For the Tonle Sap Station lists
Community Fishery (CFi) areas or non-CFi villages. Locations are the
names of fishing grounds within a CFi or around a village. For the
following functions, the data in CatchRecord, Latitude, Longitude, or
Habitat are used.</p>
<p>To run these functions you need four packages. Two, ‘plyr’,‘dplyr’,
need to be loaded.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://had.co.nz/plyr" class="external-link">plyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></code></pre></div>
<p>Whilst ‘gdata’ and ‘reshape2’ need only be installed as the code will
call them when required.</p>
<p>The simplest function <code>ES_DFC</code> will calculate the metric
across Stations for a single threshold.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ES_DFC.html">ES_DFC</a></span><span class="op">(</span><span class="va">DailyCatch</span>, <span class="fl">1.5</span>, <span class="st">'2015-01-01'</span>, <span class="st">'2021-01-08'</span><span class="op">)</span>
<span class="co">#&gt;      Parameter F1       F2       F3 ESI_F1_3</span>
<span class="co">#&gt; 1 WeightCaught 40 1.937407 12.40213 77.72703</span></code></pre></div>
<p>The <code>ES_DFC</code> function has four parameters, listed in
order</p>
<ul>
<li>x - the input date file, DailyCath in our example</li>
<li>DFC_thresh - Daily catch threshold weight, 1.5 kg in our example as
this is the amount fishers require for their daily subsistence needs,
regardless of month.</li>
<li>S_Date - Start date for the assessment period, 2015-01-01 in our
example</li>
<li>E_Date - End date for the assessment period, 2021-01-08 in our
example</li>
</ul>
<p>Rather than a single threshold for the entire time period the
<code>ES_DFC_M</code> function can calculate the metric using different
total catch weight monthly thresholds. We have two sets of monthly
thresholds one for the minimum catch required before their surplus catch
is sold to market or traders and an ideal best case daily catch
weight.</p>
<p>Table 6. Daily catch threshold weights (kg) for each month. The three
columns are threshold values for daily subsistence, surplus for trade
and ideal catch.</p>
<table class="table">
<thead><tr class="header">
<th align="right">Month</th>
<th align="left">Subsistence</th>
<th>Trade</th>
<th align="center">Ideal</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">Jan</td>
<td align="left">1.5</td>
<td>15</td>
<td align="center">50</td>
</tr>
<tr class="even">
<td align="right">Feb</td>
<td align="left">1.5</td>
<td>9</td>
<td align="center">50</td>
</tr>
<tr class="odd">
<td align="right">Mar</td>
<td align="left">1.5</td>
<td>8</td>
<td align="center">20</td>
</tr>
<tr class="even">
<td align="right">Apr</td>
<td align="left">1.5</td>
<td>4</td>
<td align="center">20</td>
</tr>
<tr class="odd">
<td align="right">May</td>
<td align="left">1.5</td>
<td>4</td>
<td align="center">10</td>
</tr>
<tr class="even">
<td align="right">Jun</td>
<td align="left">1.5</td>
<td>5</td>
<td align="center">50</td>
</tr>
<tr class="odd">
<td align="right">Jul</td>
<td align="left">1.5</td>
<td>5</td>
<td align="center">50</td>
</tr>
<tr class="even">
<td align="right">Aug</td>
<td align="left">1.5</td>
<td>5</td>
<td align="center">50</td>
</tr>
<tr class="odd">
<td align="right">Sep</td>
<td align="left">1.5</td>
<td>9</td>
<td align="center">50</td>
</tr>
<tr class="even">
<td align="right">Oct</td>
<td align="left">1.5</td>
<td>9</td>
<td align="center">50</td>
</tr>
<tr class="odd">
<td align="right">Nov</td>
<td align="left">1.5</td>
<td>10</td>
<td align="center">50</td>
</tr>
<tr class="even">
<td align="right">Dec</td>
<td align="left">1.5</td>
<td>10</td>
<td align="center">50</td>
</tr>
</tbody>
</table>
<p>This indicator requires the ‘lubridate’ package. This does not need
to be loaded as the function will call it when required.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ES_DFC_M.html">ES_DFC_M</a></span><span class="op">(</span><span class="va">DailyCatch</span>, <span class="fl">50</span>, <span class="fl">50</span>, <span class="fl">20</span>, <span class="fl">20</span>, <span class="fl">10</span>, <span class="fl">50</span>, <span class="fl">50</span>, <span class="fl">50</span>, <span class="fl">50</span>, <span class="fl">50</span>, <span class="fl">50</span>, <span class="fl">50</span>, <span class="st">'2021-01-01'</span>, <span class="st">'2021-12-31'</span><span class="op">)</span>
<span class="co">#&gt;      Parameter  F1       F2       F3 ESI_F1_3</span>
<span class="co">#&gt; 1 WeightCaught 100 98.46293 84.80139 7.912328</span></code></pre></div>
<p>The <code>ES_DFC</code> function has fifteen parameters, listed in
order:</p>
<ul>
<li>x - the input date file, DailyCath in our example</li>
<li>Jan_t - January daily catch threshold weight</li>
<li>Feb_t - February daily catch threshold weight</li>
<li>Mar_t - March daily catch threshold weight</li>
<li>Apr_t - April daily catch threshold weight</li>
<li>May_t - May daily catch threshold weight</li>
<li>Jun_t - June daily catch threshold weight</li>
<li>Jul_t - July daily catch threshold weight</li>
<li>Aug_t - August daily catch threshold weight</li>
<li>Sep_t - September daily catch threshold weight</li>
<li>Oct_t - October daily catch threshold weight</li>
<li>Nov_t - November daily catch threshold weight</li>
<li>Dec_t - December daily catch threshold weight</li>
<li>DFC_thresh - Daily catch threshold weight, 1.5 kg in our example as
this is the amount fishers require for their daily subsistence needs,
regardless of month.</li>
<li>S_Date - Start date for the assessment period, 2021-01-01 in our
example</li>
<li>E_Date - End date for the assessment period, 2021-12-31 in our
example</li>
</ul>
<p>In the example the ideal catch values are used.</p>
<p>Two further functions are provided that allow the metric to be
calculated for a single CFi.</p>
<p><code>ES_DFC_S</code> is analogous to <code>ES_DFC</code> and
<code>ES_DFC_SM</code> is analogous to <code>ES_DFC_M</code>. Both have
the addition of the ‘CFi’ parameter which names a CFi in the Station
column. The various factors in the Location column are used as the
spatial variables. Examples for both functions are as follows:</p>
<p><code>ES_DFC_S(DailyCatch, "Balat", 1.5, '2018-01-01', '2021-08-31')</code>
<code>ES_DFC_SM(DailyCatch, "Balat", 50, 50, 20, 20, 10, 50, 50, 50, 50, 50, 50, 50, '2021-01-01', '2021-12-31')</code></p>
<p>Often you may wish to select a subset of CFis (Stations) for
analysis. Typing <code>unique(Station)</code>will give the names of
stations these can be subsetted as follows:</p>
<p><code>Cfi_Pursat&lt;-filter(DailyCatch, Station %in% c("Srey Chek", "Ou Ta Prok", "Anlong Reang", "Kampong Prak"))</code></p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Shaad K, Souter NJ, Vollmer D, Regan HM, Bezerra, MO. (2021)
Integrating ecosystem services into water resource management: an
indicator-based approach. Environmental Management.</p>
<p>Souter NJ, Shaad K, Vollmer D, Regan HM, Farrell TA, Arnaiz M,
Meynell P-J, Cochrane TA, Arias ME, Piman T, Andelman SJ. (2020) Using
the Freshwater Health Index to Assess Hydropower Development Scenarios
in the Sesan, Srepok and Sekong River Basin. Water. 12(3):788. <a href="https://doi.org/10.3390/w12030788" class="external-link uri">https://doi.org/10.3390/w12030788</a></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Nicholas J Souter, Ibrahim Mohammed.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
